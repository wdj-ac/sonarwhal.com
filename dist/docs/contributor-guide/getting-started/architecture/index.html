<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Architecture | sonarwhal documentation</title> <meta property="og:image" content="/static/images/apple-touch-icon-c01d89d4f3.png"><meta property="og:description" content="sonarwhal, a linting tool for the web focused on best practices and flexibility for the end user"><meta property="og:title" content="Architecture"><meta name="description" content="sonarwhal, a linting tool for the web focused on best practices and flexibility for the end user"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#4046dd"><link rel="manifest" href="/static/site-b1a71cb190.webmanifest"><link rel="apple-touch-icon" href="/static/images/apple-touch-icon-c01d89d4f3.png"><link type="application/opensearchdescription+xml" rel="search" href="/static/opensearch-eaec25f991.xml" title="sonarwhal"><link rel="icon" href="/static/images/favicon-dd9d5dff4e.ico"> <link rel="stylesheet" href="/static/styles/common-f0d599dc94.css" integrity="sha384-FrUPgIHFNLSd41g3b26WzegsfNG/Yz4Qp63Xemf2nMMv1XrfbYJU9Dn81AMrYj2u" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500" integrity="sha384-6hCj8YZdGj+SQ9wB8ShBR1XRd+tUsQSfKu1i4C72EaUKO6AeEipi63+OPsdZPLoD" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" integrity="sha384-mHx5KeR3zcLviQFPmpHqrwf2uxtukRvUFVzOMOqIjKjSNrurxlmJ3oS+vm49Mz07" crossorigin="anonymous"><link rel="stylesheet" href="/static/styles/docs-aea1404a6b.css" integrity="sha384-Joq3wpwZ1GpeoibnNAx67vRhmwjvkm2yZ5Nq3L3n/XdiPFHORf/yu0GxMEbztADd" crossorigin="anonymous"></head><body><header class="header"><div class="header-social"><div class="header-social__container container"><img src="/static/images/jsf_logo_white-a73061e34d.svg" alt="A JS Foundation Project"><ul class="header-social__list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg-header" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg-header" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path class="medium-icon-svg-header" d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z"/></svg></a></li></ul></div></div><div class="nav-bar container"><nav class="nav"><a href="/" class="clear logo--container"><img src="/static/images/sonar-logo-4fa31d71a3.svg" alt="sonarwhal" class="header__logo navbar__navitem"></a><ul class="nav__navbar"><li class="navbar__navitem"><a role="button" href="/scanner/" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner" class="navitem__button ">Scanner</a> </li><li class="navbar__navitem"><a role="button" href="/docs/" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs" class="navitem__button expandable">Documentation</a> <ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true"><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></li><li class="navbar__navitem"><a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about" class="navitem__button expandable">About</a> <ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true"><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></li></ul><div class="nav-bar--container"><div class="nav-bar__input"><form action="/search" method="GET"><label for="search-input" class="visually-hidden">Search the documentation</label><input type="search" id="search-input" placeholder="Search Documentation" name="q" aria-label="Search"> <button type="submit" aria-label="search" class="button-search"></button></form></div><button class="mobile-close-button" aria-label="Close Search Overlay">Close</button></div><div class="nav-bar--mobile-buttons"><button class="header__toggle mobile-nav-button" aria-label="Menu"></button> <button class="header__toggle mobile-search-button" aria-label="Search"></button></div></nav></div></header><main class="container">  <article class="content" aria-labelledby="page-heading"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/">Home</a></li><li><a href="../../../">Documentation</a></li><li><a href="../../" class="guide-category">Contributor guide</a></li><li aria-current="location">Architecture</li></ul></nav><header class="page-intro"><h1 id="page-heading">Architecture</h1><div class="documentation-actions"><ul><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/edit/master/packages/sonarwhal/docs/contributor-guide/getting-started/architecture.md">Edit</a></li><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/issues/new?title=%5Bdocs%5D%20Issue%20with%20&apos;Architecture&apos;&amp;body=https%3A%2F%2Fsonarwhal.com%2Fdocs%2Fcontributor-guide%2Fgetting-started%2Farchitecture%2Findex.html">Signal Issue</a></li></ul></div></header><div class="section" id="main"><div class="layout layout--sidebar"><div class="module module--secondary mobile-view"><ul class="toc-mobile-view"><li><p role="button" id="mobile-toc" aria-controls="mobile-toc-submenu" aria-expanded="false" aria-haspopup="true" class="toc-mobile-view__button expandable">Contributor guide</p><ul role="group" class="toc-mobile-view__dropdown" id="mobile-toc-submenu" aria-hidden="true"><li class="dropdown__subitem"><a href="../../" class="subitem--single">Getting Started</a></li> <li class="dropdown__subitem"><p>getting started</p><ul><li class="subitem"><a href="/docs/contributor-guide/getting-started/architecture/">Architecture</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/development-environment/">Development environment</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/events/">Events</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/pull-requests/">Pull requests</a></li></ul></li><li class="dropdown__subitem"><p>guides</p><ul><li class="subitem"><a href="/docs/contributor-guide/guides/create-custom-rule/">Create a custom rule step-by-step</a></li></ul></li><li class="dropdown__subitem"><p>how to</p><ul><li class="subitem"><a href="/docs/contributor-guide/how-to/connector/">Develop a connector</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/formatter/">Develop a formatter</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/parser/">Develop a parser</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/rule/">Develop a rule</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/common-rule-scenarios/">Implement common rule scenarios</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/test-rules/">Test a rule</a></li></ul></li></ul></li></ul></div><div class="module module--secondary table-of-contents treeview main-view" role="navigation"><ul role="tree" aria-labelledby="page-heading" tabindex="0"><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="true"><div class=" toc-section-title--active "><span class="text">getting started</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="true"><div class=" toc-subsection-title--active " aria-current="location"><a class="text" href="/docs/contributor-guide/getting-started/architecture/" tabindex="0">Architecture</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/development-environment/" tabindex="0">Development environment</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/events/" tabindex="0">Events</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/pull-requests/" tabindex="0">Pull requests</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">guides</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/guides/create-custom-rule/" tabindex="-1">Create a custom rule step-by-step</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">how to</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/connector/" tabindex="-1">Develop a connector</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/formatter/" tabindex="-1">Develop a formatter</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/parser/" tabindex="-1">Develop a parser</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/rule/" tabindex="-1">Develop a rule</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/common-rule-scenarios/" tabindex="-1">Implement common rule scenarios</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/test-rules/" tabindex="-1">Test a rule</a></div></li></ul></li></ul></div><div class="module module--primary wrap-text"> <h1 id="architecture">Architecture<a href="#architecture" class="headerlink" title="Architecture"></a></h1><p><code>sonarwhal</code> was designed with extensibility in mind. At a high level, this is
the project&#x2019;s architecture:</p>
<p><a href="/static/images/architecture-cc43a45a2a.svg"><img src="/static/images/architecture-cc43a45a2a.svg" alt="sonarwhal&apos;s architecture"></a></p>
<p>The main piece is <code>sonarwhal</code>. It&#x2019;s an object that extends from <code>EventEmitter</code>.
This means that the communication between all the different parts is going to
be done mostly via <a href="./events.md"><code>event</code>s</a>. The other pieces are:</p>
<ul>
<li><code>rule</code>: Is a group of related tests that are run on a resource (HTML,
document, image, request, etc.). E.g.: Verify that the HTML document has a
valid language declared.
<a href="../how-to/rule.md">Learn how to develop a <code>rule</code></a>.</li>
<li><code>connector</code>: Is the way in which <code>sonarwhal</code> obtains information about the
DOM, network information, resources, etc. The underlying technique (debugging
protocol, web driver, etc.) to access this data does not matter to the rest
of the system.
<a href="../how-to/connector.md">Learn how to develop a <code>connector</code></a>.</li>
<li><code>formatter</code>: Transforms the results into something useful to the user. It
could be as simple as printing out the results to the command line, or
something more complex like creating an HTML report.
<a href="../how-to/formatter.md">Learn how to developer a <code>formatter</code></a>.</li>
<li><code>parser</code>: Understands a particular resource type (e.g.: JavaScript,
stylesheet, webmanifest, etc.), parses it, and emits related event(s) so
<code>rule</code>s can take action on them.
<a href="../how-to/parser.md">Learn how to develop a <code>parser</code></a>.</li>
</ul>
<p>When a user invokes <code>sonarwhal https://example.com</code> basically what happens is
this:</p>
<ol>
<li>The <code>CLI</code> creates a new <code>SonarwhalConfig</code> object based on the user&#x2019;s
<code>.sonarwharc</code> file. This process validates that the rules are configured
correctly, etc.</li>
<li>The <code>CLI</code> then passes this <code>SonarwhalConfig</code> to the <code>resource-loader</code> that
will return a <code>SonarwhalResources</code> object that contains the <code>Constructors</code>
of the configured resources. <code>resource-loader</code> checks at the same time if
the resources actually exist, are compatible with the current <code>sonarwhal</code>
version, etc. If there are missing dependencies, the names will be in the
<code>missing</code> property of the result. For incompatibilities, it will be the
<code>incompatible</code>.</li>
<li>If everything goes well, a new <code>Sonarwhal</code> object is created using the
previous <code>SonarwhalConfig</code> and <code>SonarwhalResources</code>, then <code>CLI</code> calls its
<code>analyze</code> method.</li>
<li><code>sonarwhal</code> then calls the <code>collect</code> method of the configured <code>connector</code>.</li>
<li>The <code>connector</code> will navigate to the <code>URL</code> traverse the HTML, and send
<code>event</code>s related to this and the resource loading process.</li>
<li>If a <code>parser</code> has subscribed to one of the emitted <code>event</code>s, it will parse
that resource and <code>emit</code> new <code>event</code>s.</li>
<li><code>rule</code>s can subscribe to any <code>event</code> no matter where it&#x2019;s comming from
(<code>connector</code> or <code>parser</code>). If they find an issue, it will be reported via the
<code>report</code> method.</li>
<li>Once <code>sonarwhal</code> has finished analyzing the website, the results are returned
to <code>CLI</code> that will print them using the configured <code>formatter</code>(s).</li>
</ol>
<p>Any developer can create their own <code>rule</code>s, <code>connector</code>s, <code>parser</code>s
and/or <code>formatter</code>s, and use them without having to do a pull request to
the main project and distribute them as <a href="https://www.npmjs.com/" target="_blank" rel="nofollow noreferrer noopener"><code>npm</code></a> packages.</p>
<!-- Link labels: -->
 </div></div><a href="#main" class="anchor-top" hidden aria-label="back to top">top</a></div></article>  </main><footer class="footer footer--home"><div class="footer-nav container"><div class="footer-nav__item"><p class="category"><a href="/scanner/">Scanner</a></p><ul></ul></div><div class="footer-nav__item"><p class="category"><a href="/docs/">Documentation</a></p><ul><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></div><div class="footer-nav__item"><p class="category"><a href="/about/">About</a></p><ul><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></div><ul class="footer-nav__item social-list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z" class="medium-icon-svg"/></svg></a></li></ul></div></footer><script src="/static/scripts/treeview-e14923d6bd.js" integrity="sha384-f4cDTA+aFtC3QxumypR+xrziAyyNLALeZLCcS4ZXdc/O93x/9Xyk/IzcUOmkNBDY" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" integrity="sha384-bpcisN7hXHzDmg5JLgtPet7fpev9Wwwqgw8zlXpOh7AkvJ+wYjwrMzHH8fVvq1Dq" crossorigin="anonymous"></script><script src="/static/scripts/common-234f1d98cc.js" integrity="sha384-uQNhTpxyfsvKX1WnECKzm/7fYOFRWjGPmomV8W31O1ZNYBQWBcYpjjO4OqmpZ4M6" crossorigin="anonymous"></script><script>!function(){var e,t=docsearch({apiKey:"2ee58f908e6d720c4f72a9645ce0e857",indexName:"sonarwhal",inputSelector:"#search-input",appId:"0R8E5SPAFP",debug:!1,handleSelected:function(t,o,n){window.innerWidth<e?o.target.closest("form").submit():window.location.href=n.url}}),o=document.querySelector(".algolia-autocomplete .ds-dropdown-menu");e=parseInt(window.getComputedStyle(o).minWidth),t.autocomplete.on("autocomplete:opened",function(){document.body.clientWidth<e&&t.autocomplete.autocomplete.close()})}()</script><script src="/sw-reg.js" integrity="sha384-gRovFrJVkjTNXoDUATy5auNPBtLX1kLAiFPr0Y0558FvYta2yNWP955eXf8tv0KU" crossorigin="anonymous"></script><script>!function(e,a,t,c,g){e.GoogleAnalyticsObject="ga",e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,c=a.createElement("script"),g=a.scripts[0],c.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(this,document),ga("create","UA-101540923-1"),ga("send","pageview")</script></body></html>