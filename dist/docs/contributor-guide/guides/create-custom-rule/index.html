<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Create a custom rule step-by-step | sonarwhal documentation</title> <meta property="og:image" content="/static/images/apple-touch-icon-c01d89d4f3.png"><meta property="og:description" content="sonarwhal, a linting tool for the web focused on best practices and flexibility for the end user"><meta property="og:title" content="Create a custom rule step-by-step"><meta name="description" content="sonarwhal, a linting tool for the web focused on best practices and flexibility for the end user"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#4046dd"><link rel="manifest" href="/static/site-b1a71cb190.webmanifest"><link rel="apple-touch-icon" href="/static/images/apple-touch-icon-c01d89d4f3.png"><link type="application/opensearchdescription+xml" rel="search" href="/static/opensearch-eaec25f991.xml" title="sonarwhal"><link rel="icon" href="/static/images/favicon-dd9d5dff4e.ico"> <link rel="stylesheet" href="/static/styles/common-f0d599dc94.css" integrity="sha384-FrUPgIHFNLSd41g3b26WzegsfNG/Yz4Qp63Xemf2nMMv1XrfbYJU9Dn81AMrYj2u" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500" integrity="sha384-6hCj8YZdGj+SQ9wB8ShBR1XRd+tUsQSfKu1i4C72EaUKO6AeEipi63+OPsdZPLoD" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" integrity="sha384-mHx5KeR3zcLviQFPmpHqrwf2uxtukRvUFVzOMOqIjKjSNrurxlmJ3oS+vm49Mz07" crossorigin="anonymous"><link rel="stylesheet" href="/static/styles/docs-aea1404a6b.css" integrity="sha384-Joq3wpwZ1GpeoibnNAx67vRhmwjvkm2yZ5Nq3L3n/XdiPFHORf/yu0GxMEbztADd" crossorigin="anonymous"></head><body><header class="header"><div class="header-social"><div class="header-social__container container"><img src="/static/images/jsf_logo_white-a73061e34d.svg" alt="A JS Foundation Project"><ul class="header-social__list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg-header" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg-header" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path class="medium-icon-svg-header" d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z"/></svg></a></li></ul></div></div><div class="nav-bar container"><nav class="nav"><a href="/" class="clear logo--container"><img src="/static/images/sonar-logo-4fa31d71a3.svg" alt="sonarwhal" class="header__logo navbar__navitem"></a><ul class="nav__navbar"><li class="navbar__navitem"><a role="button" href="/scanner/" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner" class="navitem__button ">Scanner</a> </li><li class="navbar__navitem"><a role="button" href="/docs/" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs" class="navitem__button expandable">Documentation</a> <ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true"><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></li><li class="navbar__navitem"><a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about" class="navitem__button expandable">About</a> <ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true"><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></li></ul><div class="nav-bar--container"><div class="nav-bar__input"><form action="/search" method="GET"><label for="search-input" class="visually-hidden">Search the documentation</label><input type="search" id="search-input" placeholder="Search Documentation" name="q" aria-label="Search"> <button type="submit" aria-label="search" class="button-search"></button></form></div><button class="mobile-close-button" aria-label="Close Search Overlay">Close</button></div><div class="nav-bar--mobile-buttons"><button class="header__toggle mobile-nav-button" aria-label="Menu"></button> <button class="header__toggle mobile-search-button" aria-label="Search"></button></div></nav></div></header><main class="container">  <article class="content" aria-labelledby="page-heading"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/">Home</a></li><li><a href="../../../">Documentation</a></li><li><a href="../../" class="guide-category">Contributor guide</a></li><li aria-current="location">Create a custom rule step-by-step</li></ul></nav><header class="page-intro"><h1 id="page-heading">Create a custom rule step-by-step</h1><div class="documentation-actions"><ul><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/edit/master/packages/sonarwhal/docs/contributor-guide/guides/create-custom-rule.md">Edit</a></li><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/issues/new?title=%5Bdocs%5D%20Issue%20with%20&apos;Create%20a%20custom%20rule%20step-by-step&apos;&amp;body=https%3A%2F%2Fsonarwhal.com%2Fdocs%2Fcontributor-guide%2Fguides%2Fcreate-custom-rule%2Findex.html">Signal Issue</a></li></ul></div></header><div class="section" id="main"><div class="layout layout--sidebar"><div class="module module--secondary mobile-view"><ul class="toc-mobile-view"><li><p role="button" id="mobile-toc" aria-controls="mobile-toc-submenu" aria-expanded="false" aria-haspopup="true" class="toc-mobile-view__button expandable">Contributor guide</p><ul role="group" class="toc-mobile-view__dropdown" id="mobile-toc-submenu" aria-hidden="true"><li class="dropdown__subitem"><a href="../../" class="subitem--single">Getting Started</a></li> <li class="dropdown__subitem"><p>getting started</p><ul><li class="subitem"><a href="/docs/contributor-guide/getting-started/architecture/">Architecture</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/development-environment/">Development environment</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/events/">Events</a></li><li class="subitem"><a href="/docs/contributor-guide/getting-started/pull-requests/">Pull requests</a></li></ul></li><li class="dropdown__subitem"><p>guides</p><ul><li class="subitem"><a href="/docs/contributor-guide/guides/create-custom-rule/">Create a custom rule step-by-step</a></li></ul></li><li class="dropdown__subitem"><p>how to</p><ul><li class="subitem"><a href="/docs/contributor-guide/how-to/connector/">Develop a connector</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/formatter/">Develop a formatter</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/parser/">Develop a parser</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/rule/">Develop a rule</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/common-rule-scenarios/">Implement common rule scenarios</a></li><li class="subitem"><a href="/docs/contributor-guide/how-to/test-rules/">Test a rule</a></li></ul></li></ul></li></ul></div><div class="module module--secondary table-of-contents treeview main-view" role="navigation"><ul role="tree" aria-labelledby="page-heading" tabindex="0"><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">getting started</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/architecture/" tabindex="-1">Architecture</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/development-environment/" tabindex="-1">Development environment</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/events/" tabindex="-1">Events</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/getting-started/pull-requests/" tabindex="-1">Pull requests</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="true"><div class=" toc-section-title--active "><span class="text">guides</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="true"><div class=" toc-subsection-title--active " aria-current="location"><a class="text" href="/docs/contributor-guide/guides/create-custom-rule/" tabindex="0">Create a custom rule step-by-step</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">how to</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/connector/" tabindex="-1">Develop a connector</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/formatter/" tabindex="-1">Develop a formatter</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/parser/" tabindex="-1">Develop a parser</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/rule/" tabindex="-1">Develop a rule</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/common-rule-scenarios/" tabindex="-1">Implement common rule scenarios</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/contributor-guide/how-to/test-rules/" tabindex="-1">Test a rule</a></div></li></ul></li></ul></div><div class="module module--primary wrap-text"> <h1 id="create-a-custom-rule-step-by-step">Create a custom rule step-by-step<a href="#create-a-custom-rule-step-by-step" class="headerlink" title="Create a custom rule step-by-step"></a></h1><p>Imagine that we have a new change in the sonarwhal website - we&#x2019;d like
to add a footer containing the copyright information <code>(c) sonarwhal</code> and
we need to verify that this footer is always present in the page before
deployment. Let&#x2019;s see how we can write this as a rule for sonarwhal so
that we can use sonarwhal to validate the copyright in the footer for us.</p>
<h2 id="what-is-a-rule">What is a rule?<a href="#what-is-a-rule" class="headerlink" title="What is a rule?"></a></h2><p>First of all, let&#x2019;s grasp what a rule is and how it works. A rule is at the core
of sonarwhal, it is a check that is used to verify if something was done as
intended. In our example, if a page doesn&#x2019;t have a footer or has a footer but
misses the <code>(c) sonarwhal part</code>, the rule fails. Otherwise it passes. A rule
subscribes to one or more events that are emitted from a connector. A connector
is the way sonarwhal gets the information about a website or a resource using a
browser, or something different that reads files from disk. For example, if a
rule subscribes to <code>fetch::end::&lt;resource-type&gt;</code>, it means this rule will run each time the
connector finishes downloading a resource file.</p>
<h2 id="what-is-it-like-to-create-a-new-rule">What is it like to create a new rule?<a href="#what-is-it-like-to-create-a-new-rule" class="headerlink" title="What is it like to create a new rule?"></a></h2><p>The recommended way to create a new rule is to use the <code>&#x2014;-new-rule</code> parameter in
CLI. Support for bootstrapping custom rules has shipped in sonarwhal since
v0.20.1. sonarwhal can be installed globally to have access to the sonarwhal
command directly. You can also install it locally and run it via npm scripts or
using the <code>npx</code> command.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g --engine-strict sonarwhal</span><br></pre></td></tr></table></figure>
<p>Afterwards, we navigated to the folder where we&#x2019;d like to put the rule project,
and then run the command to start a new custom rule:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sonarwhal --new-rule</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>: If you are creating a new rule for the main repo you can use
<code>yarn new:rule</code> or <code>npm run new:rule</code> from the root and it will be created
automatically in the <code>packages</code> folder.</p>
<p>At this point, a wizard will ask a series of questions relevant to the new rule,
including the name, description, category, etc. In particular, you will be asked
to select the category of the use case for the new rules. Depending on the
answer, sonarwhal will automatically decide which <code>event</code>(s) it should subscribe
the rule to. Of course, you can subscribe to others if needed. The list below
might help if you wonder what those options mean:</p>
<ul>
<li><code>DOM</code>: Is your rule checking a particular <code>DOM</code> element like <code>head</code> or
<code>link</code> ?</li>
<li><code>Resource Request</code>: Does your rule rely on the loading of a resource like
<code>script</code>, <code>stylesheet</code>, or an <code>image</code>?</li>
<li><code>Third Party Service</code>: Does your rule integrate with a third-party service?</li>
<li><code>JavaScript Injection</code>: Do you need to inject a script in the page and wait
for the results to execute your test?</li>
</ul>
<p>In our case, we&#x2019;d like to check the content of the footer element, so we select
DOM and then type input footer. Wait for a second&#x2026; Voil&#xE0;! A new folder called
<code>rule-validate-footer</code> is created, with a bunch of templates in it. The main
structure of the folder is like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rule-validate-footer</span><br><span class="line">&#x251C;&#x2500;&#x2500; src</span><br><span class="line">&#x2502;   &#x2514;&#x2500;&#x2500; rules</span><br><span class="line">&#x2502;   &#x2502;      &#x2514;&#x2500;&#x2500; validate-footer</span><br><span class="line">&#x2502;   &#x2502;             &#x2514;&#x2500;&#x2500; validate-footer.ts</span><br><span class="line">&#x2502;   &#x2514;&#x2500;&#x2500; index.ts</span><br><span class="line">&#x2514;&#x2500;&#x2500; tests</span><br><span class="line">    &#x2514;&#x2500;&#x2500; validate-footer</span><br><span class="line">          &#x2514;&#x2500;&#x2500; test.ts</span><br></pre></td></tr></table></figure>
<p>The next main thing to do is to populate the <code>validate-footer.ts</code> and <code>test.ts</code>
with our actual rule and tests. But before that, we need to navigate to the rule
folder and run <code>npm run init</code>. This command does two things:</p>
<ol>
<li>install all the dependencies</li>
<li>build the project, which compiles the TypeScript to JavaScript in the <code>dist</code>
folder (support for creating JavaScript rules via sonarwhal&#x2019;s CLI will be
added in a future release, but you can manually do it now).</li>
</ol>
<p>Do remember that since a compilation is needed, you have to run build every time
after you make changes to the .ts files. Or alternatively, you run <code>npm run watch:ts</code> in the terminal and the project builds itself after each update. <em>If
your debugger never stops at the break point you set up, it&#x2019;s very likely
because you forgot to build your project after making changes.</em></p>
<h2 id="how-do-we-write-the-rule">How do we write the rule?<a href="#how-do-we-write-the-rule" class="headerlink" title="How do we write the rule?"></a></h2><p>Now navigate to <code>src/rules/validate-footer/validate-footer.ts</code>. You can see that
there is already some code there. The rule class contains a constructor
<code>constructor</code> and a static property <code>meta</code>.
At the end of the <code>constructor</code>, it use <code>context.on</code> to subscribe the rule
to events the rule needs to listen to. The parameters for  <code>contexts.on</code> are the
name of the event and the validating function triggered upon the
events. In the generated template by the wizard, the <code>element::footer</code> event is
already populated for us so we can focus on implementing the actual
validateFooter function. As shown in the code below, we have access to the
footer element in the page and use that for our check - if the HTML doesn&#x2019;t
include the target string, we simply file a report by calling <code>context.report</code>
with the <em>resource</em> (URL), the <em>element</em> (footer), and the <em>error message</em>.
Note that <code>context.report</code> is an asynchronous method, so always use <code>await</code>.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> FooterRule <span class="keyword">implements</span> IRule {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> readonly meta: RuleMetadata = {</span><br><span class="line">        docs: {</span><br><span class="line">            category: Category.other,</span><br><span class="line">            description: <span class="string">`A rule to validate footer`</span></span><br><span class="line">        },</span><br><span class="line">        id: <span class="string">&apos;footer&apos;</span>,</span><br><span class="line">        recommended: <span class="literal">false</span>,</span><br><span class="line">        schema: [],</span><br><span class="line">        worksWithLocalFiles: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">context: RuleContext</span>) {</span><br><span class="line">        <span class="keyword">const</span> stringToBeIncluded = <span class="string">`(c) sonarwhal`</span>;</span><br><span class="line">        <span class="keyword">const</span> validateFooter = <span class="keyword">async</span> (elementFound: ElementFound) =&gt; {</span><br><span class="line">            <span class="keyword">const</span> { element, resource } = elementFound;</span><br><span class="line">            <span class="keyword">const</span> footerHTML = <span class="keyword">await</span> element.outerHTML();</span><br><span class="line"></span><br><span class="line">            debug(<span class="string">`Validating rule validate-footer`</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!footerHTML.includes(stringToBeIncluded)) {</span><br><span class="line">                <span class="keyword">await</span> context.report(resource, element, <span class="string">`&quot;<span class="subst">${stringToBeIncluded}</span>&quot; is not included in the footer.`</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        context.on(<span class="string">&apos;element::footer&apos;</span>, validateFooter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>And now run <code>sonarwhal https://sonarwhal.com</code> in the terminal and wait for the
scan to complete. Ta-Dah! We get the result below. It reports an error since we
don&#x2019;t have the <code>(c) sonarwhal</code> footer in the sonarwhal.com home page.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://sonarwhal.com/</span><br><span class="line">line 1  col 8379  Error  &quot;(c) sonarwhal&quot; is not included in the footer.  validate-footer</span><br><span class="line">&#x2716; Found 1 error and 0 warnings</span><br><span class="line"></span><br><span class="line">&#x2716; Found a total of 1 error and 0 warnings</span><br></pre></td></tr></table></figure>
<p>You might be wondering what if the page doesn&#x2019;t include a footer at all, then
the <code>footer::element</code> event will never be emitted. You can find the completed
code to address this in <a href="https://github.com/qzhou1607/sonarwhal-external-rule-demo/blob/9e350afa23e4bd3245745afddc3a0cef4795f60b/src/rules/validate-footer/validate-footer.ts" target="_blank" rel="nofollow noreferrer noopener">validate-footer.ts</a> of <a href="https://github.com/qzhou1607/sonarwhal-external-rule-demo" target="_blank" rel="nofollow noreferrer noopener">this
repository</a>. The general idea is to subscribe the rule to another
event <code>traverse::end</code>, and validate the existence of the <code>footer</code> element at the
end of the DOM tree traversal.</p>
<h2 id="how-do-we-config-the-rule">How do we config the rule?<a href="#how-do-we-config-the-rule" class="headerlink" title="How do we config the rule?"></a></h2><p>So what if you decided to change the copyright text content? Altering the rule
itself every time is messy, and sonarwhal makes it easy to add config options
for a rule, You have access to the config properties through
<code>context.ruleOptions</code> and you can load the dynamic value of the target string
when the rule is loaded.</p>
<p>In our case, we define a config option with the key of <code>stringToBeIncluded</code>. And
if this config is not defined, the target string falls back to <code>(c) sonarwhal</code>.
Meanwhile, we also need to specify the JSON schema of the configurable options
in the <code>meta</code> part of the rule constructor. This helps the rule to decide if a
config option is valid before using it.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> CopyrightRule <span class="keyword">implements</span> IRule {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> readonly meta: RuleMetadata = {</span><br><span class="line">        docs: {</span><br><span class="line">            category: Category.other,</span><br><span class="line">            description: <span class="string">`A new rule to validate footer`</span></span><br><span class="line">        },</span><br><span class="line">        id: <span class="string">&apos;copyright&apos;</span>,</span><br><span class="line">        recommended: <span class="literal">false</span>,</span><br><span class="line">        schema: [{</span><br><span class="line">            additionalProperties: <span class="literal">false</span>,</span><br><span class="line">            properties: {</span><br><span class="line">                <span class="comment">// Define JSON schema for the config options.</span></span><br><span class="line">                stringToBeIncluded: { <span class="keyword">type</span>: <span class="string">&apos;string&apos;</span> }</span><br><span class="line">            }</span><br><span class="line">        }],</span><br><span class="line">        worksWithLocalFiles: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">context: RuleContext</span>) {</span><br><span class="line">        <span class="keyword">let</span> stringToBeIncluded;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> loadRuleConfigs = <span class="function"><span class="params">()</span> =&gt;</span> {</span><br><span class="line">            <span class="comment">// Load Config options.</span></span><br><span class="line">            stringToBeIncluded = (context.ruleOptions &amp;&amp; context.ruleOptions.stringToBeIncluded) || <span class="string">`(c) sonarwhal`</span>;</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> validateFooter = <span class="keyword">async</span> (elementFound: ElementFound) =&gt; { ... };</span><br><span class="line"></span><br><span class="line">        loadRuleConfigs();</span><br><span class="line"></span><br><span class="line">        context.on(<span class="string">&apos;element::footer&apos;</span>, validateFooter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Accordingly, when running sonarwhal, we need to pass in the config values. We do
it in the config file for sonarwhal, <code>.sonarwhalrc</code> in the root directory. For
example, if we&#x2019;d like to validate the presence of <code>(c) sonarwhal.com</code> in the
footer instead, we define the value of <code>stringToBeIncluded</code> in an object
following the severity level.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">&quot;validate-footer&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;error&quot;</span>,</span><br><span class="line">        {</span><br><span class="line">            <span class="attr">&quot;stringToBeIncluded&quot;</span>: <span class="string">&quot;(c) sonarwhal.com&quot;</span></span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Now let&#x2019;s run the rule again and here is what we get. Did you notice that now
instead of checking for <code>(c) sonarwhal</code>, the rule reports the missing of <code>(c) sonarwhal.com</code>? Hooray!</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://sonarwhal.com/</span><br><span class="line">line 1  col 8403  Error  &quot;(c) sonarwhal.com&quot; is not included in the footer.  validate-footer</span><br><span class="line">&#x2716; Found 1 error and 0 warnings</span><br><span class="line"></span><br><span class="line">&#x2716; Found a total of 1 error and 0 warnings</span><br></pre></td></tr></table></figure>
<h2 id="how-do-we-add-the-tests">How do we add the tests?<a href="#how-do-we-add-the-tests" class="headerlink" title="How do we add the tests?"></a></h2><p>Navigate to <code>src/tests/validate-footer/test.ts</code>, we will start from the
generated template. The testRule method in the ruleRunner takes three
arguments,the <em>name</em> of the rule, the <em>tests</em>, and the <em>rule config options</em>
(optional). The <em>tests</em> are defined as an array of objects, with each object
representing a test scenario. By defining <code>serverConfig</code> in each test, we are
able to mock the response from a target website and sonarwhal will compare the
actual scanning result with the messages listed in reports. The
<code>generateHTMLPage</code> helper function shipped with sonarwhal comes in handy as a
wrapper when you need HTML containing an element of interest. Here is what the
tests look like, three scenarios are mocked:</p>
<ul>
<li>A footer exists and it contains the target string. <code>pass</code></li>
<li>No footer exists in the page.  <code>fail</code></li>
<li>A footer exists, but it doesn&#x2019;t contain the target string. <code>fail</code></li>
</ul>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> footer = {</span><br><span class="line">    noFooter: <span class="string">``</span>,</span><br><span class="line">    noProblem: <span class="string">`&lt;footer&gt;(c) sonarwhal&lt;/footer&gt;`</span>,</span><br><span class="line">    wrongTextInFooter: <span class="string">`&lt;footer&gt;(c) Sonarwhal&lt;/footer&gt;`</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</span><br><span class="line">    {</span><br><span class="line">        name: <span class="string">`Footer exists and it contains &apos;(c) sonarwhal&apos;`</span>,</span><br><span class="line">        serverConfig: generateHTMLPage(<span class="string">&apos;&apos;</span>, footer.noProblem)</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        name: <span class="string">`Footer doesn&apos;t exist`</span>,</span><br><span class="line">        reports: [{ message: <span class="string">`&lt;footer&gt; element doesn&apos;t exist in this page.`</span> }],</span><br><span class="line">        serverConfig: generateHTMLPage(<span class="string">&apos;&apos;</span>, footer.noFooter)</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        name: <span class="string">`Footer exists, but doesn&apos;t contain &apos;(c) sonarwhal&apos;`</span>,</span><br><span class="line">        reports: [{ message: <span class="string">`&quot;(c) sonarwhal&quot; is not included in the footer.`</span> }],</span><br><span class="line">        serverConfig: generateHTMLPage(<span class="string">&apos;&apos;</span>, footer.wrongTextInFooter)</span><br><span class="line">    }</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tests that use the default target string.</span></span><br><span class="line">ruleRunner.testRule(ruleName, defaultTests);</span><br></pre></td></tr></table></figure>
<p>Run <code>npm run test</code> in the terminal, and sonarwhal will run them in all the
available connectors.</p>
<p>See the complete code example in <a href="https://github.com/qzhou1607/sonarwhal-external-rule-demo" target="_blank" rel="nofollow noreferrer noopener">this repository</a>.</p>
 </div></div><a href="#main" class="anchor-top" hidden aria-label="back to top">top</a></div></article>  </main><footer class="footer footer--home"><div class="footer-nav container"><div class="footer-nav__item"><p class="category"><a href="/scanner/">Scanner</a></p><ul></ul></div><div class="footer-nav__item"><p class="category"><a href="/docs/">Documentation</a></p><ul><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></div><div class="footer-nav__item"><p class="category"><a href="/about/">About</a></p><ul><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></div><ul class="footer-nav__item social-list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z" class="medium-icon-svg"/></svg></a></li></ul></div></footer><script src="/static/scripts/treeview-e14923d6bd.js" integrity="sha384-f4cDTA+aFtC3QxumypR+xrziAyyNLALeZLCcS4ZXdc/O93x/9Xyk/IzcUOmkNBDY" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" integrity="sha384-bpcisN7hXHzDmg5JLgtPet7fpev9Wwwqgw8zlXpOh7AkvJ+wYjwrMzHH8fVvq1Dq" crossorigin="anonymous"></script><script src="/static/scripts/common-234f1d98cc.js" integrity="sha384-uQNhTpxyfsvKX1WnECKzm/7fYOFRWjGPmomV8W31O1ZNYBQWBcYpjjO4OqmpZ4M6" crossorigin="anonymous"></script><script>!function(){var e,t=docsearch({apiKey:"2ee58f908e6d720c4f72a9645ce0e857",indexName:"sonarwhal",inputSelector:"#search-input",appId:"0R8E5SPAFP",debug:!1,handleSelected:function(t,o,n){window.innerWidth<e?o.target.closest("form").submit():window.location.href=n.url}}),o=document.querySelector(".algolia-autocomplete .ds-dropdown-menu");e=parseInt(window.getComputedStyle(o).minWidth),t.autocomplete.on("autocomplete:opened",function(){document.body.clientWidth<e&&t.autocomplete.autocomplete.close()})}()</script><script src="/sw-reg.js" integrity="sha384-gRovFrJVkjTNXoDUATy5auNPBtLX1kLAiFPr0Y0558FvYta2yNWP955eXf8tv0KU" crossorigin="anonymous"></script><script>!function(e,a,t,c,g){e.GoogleAnalyticsObject="ga",e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,c=a.createElement("script"),g=a.scripts[0],c.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(this,document),ga("create","UA-101540923-1"),ga("send","pageview")</script></body></html>