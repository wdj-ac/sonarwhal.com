<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Require resources to be served compressed | sonarwhal documentation</title> <meta property="og:image" content="/static/images/apple-touch-icon-c01d89d4f3.png"><meta property="og:description" content="http-compression warns against serving resources uncompressedor using an inappropriate encoding."><meta property="og:title" content="Require resources to be served compressed"><meta name="description" content="http-compression warns against serving resources uncompressedor using an inappropriate encoding."><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#4046dd"><link rel="manifest" href="/static/site-b1a71cb190.webmanifest"><link rel="apple-touch-icon" href="/static/images/apple-touch-icon-c01d89d4f3.png"><link type="application/opensearchdescription+xml" rel="search" href="/static/opensearch-eaec25f991.xml" title="sonarwhal"><link rel="icon" href="/static/images/favicon-dd9d5dff4e.ico"> <link rel="stylesheet" href="/static/styles/common-f0d599dc94.css" integrity="sha384-FrUPgIHFNLSd41g3b26WzegsfNG/Yz4Qp63Xemf2nMMv1XrfbYJU9Dn81AMrYj2u" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500" integrity="sha384-6hCj8YZdGj+SQ9wB8ShBR1XRd+tUsQSfKu1i4C72EaUKO6AeEipi63+OPsdZPLoD" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" integrity="sha384-mHx5KeR3zcLviQFPmpHqrwf2uxtukRvUFVzOMOqIjKjSNrurxlmJ3oS+vm49Mz07" crossorigin="anonymous"><link rel="stylesheet" href="/static/styles/docs-aea1404a6b.css" integrity="sha384-Joq3wpwZ1GpeoibnNAx67vRhmwjvkm2yZ5Nq3L3n/XdiPFHORf/yu0GxMEbztADd" crossorigin="anonymous"></head><body><header class="header"><div class="header-social"><div class="header-social__container container"><img src="/static/images/jsf_logo_white-a73061e34d.svg" alt="A JS Foundation Project"><ul class="header-social__list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg-header" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg-header" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path class="medium-icon-svg-header" d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z"/></svg></a></li></ul></div></div><div class="nav-bar container"><nav class="nav"><a href="/" class="clear logo--container"><img src="/static/images/sonar-logo-4fa31d71a3.svg" alt="sonarwhal" class="header__logo navbar__navitem"></a><ul class="nav__navbar"><li class="navbar__navitem"><a role="button" href="/scanner/" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner" class="navitem__button ">Scanner</a> </li><li class="navbar__navitem"><a role="button" href="/docs/" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs" class="navitem__button expandable">Documentation</a> <ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true"><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></li><li class="navbar__navitem"><a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about" class="navitem__button expandable">About</a> <ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true"><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></li></ul><div class="nav-bar--container"><div class="nav-bar__input"><form action="/search" method="GET"><label for="search-input" class="visually-hidden">Search the documentation</label><input type="search" id="search-input" placeholder="Search Documentation" name="q" aria-label="Search"> <button type="submit" aria-label="search" class="button-search"></button></form></div><button class="mobile-close-button" aria-label="Close Search Overlay">Close</button></div><div class="nav-bar--mobile-buttons"><button class="header__toggle mobile-nav-button" aria-label="Menu"></button> <button class="header__toggle mobile-search-button" aria-label="Search"></button></div></nav></div></header><main class="container">   <article class="content" aria-labelledby="page-heading"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/">Home</a></li><li><a href="../../../">Documentation</a></li><li><a href="../../" class="guide-category">User guide</a></li><li aria-current="location">Require resources to be served compressed</li></ul></nav><header class="page-intro"><h1 id="page-heading">Require resources to be served compressed</h1><div class="documentation-actions"><ul><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/edit/master/packages/rule-http-compression/README.md">Edit</a></li><li><a target="_blank" href="https://github.com/sonarwhal/sonarwhal/issues/new?title=%5Bdocs%5D%20Issue%20with%20&apos;Require%20resources%20to%20be%20served%20compressed&apos;&amp;body=https%3A%2F%2Fsonarwhal.com%2Fdocs%2Fuser-guide%2Frules%2Frule-http-compression%2Findex.html">Signal Issue</a></li></ul></div></header><div class="section" id="main"><div class="layout layout--sidebar"><div class="module module--secondary mobile-view"><ul class="toc-mobile-view"><li><p role="button" id="mobile-toc" aria-controls="mobile-toc-submenu" aria-expanded="false" aria-haspopup="true" class="toc-mobile-view__button expandable">User guide</p><ul role="group" class="toc-mobile-view__dropdown" id="mobile-toc-submenu" aria-hidden="true"><li class="dropdown__subitem"><a href="../../" class="subitem--single">Getting Started</a></li> <li class="dropdown__subitem"><p>concepts</p><ul><li class="subitem"><a href="/docs/user-guide/concepts/configurations/">Configurations</a></li><li class="subitem"><a href="/docs/user-guide/concepts/connectors/">Connectors</a></li><li class="subitem"><a href="/docs/user-guide/concepts/formatters/">Formatters</a></li><li class="subitem"><a href="/docs/user-guide/concepts/parsers/">Parsers</a></li><li class="subitem"><a href="/docs/user-guide/concepts/rules/">Rules</a></li></ul></li><li class="dropdown__subitem"><p>further configuration</p><ul><li class="subitem"><a href="/docs/user-guide/further-configuration/sonarwhalrc-formats/">.sonarwhalrc formats</a></li><li class="subitem"><a href="/docs/user-guide/further-configuration/browser-context/">Browser configuration</a></li><li class="subitem"><a href="/docs/user-guide/further-configuration/ignoring-domains/">Ignoring domains</a></li><li class="subitem"><a href="/docs/user-guide/further-configuration/rules-timeout/">Rules timeout</a></li><li class="subitem"><a href="/docs/user-guide/further-configuration/website-authentication/">Website authentication</a></li></ul></li><li class="dropdown__subitem"><p>rules</p><ul><li class="subitem"><a href="/docs/user-guide/rules/rule-amp-validator/">AMP HTML Validator</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-axe/">Accessibility assessment with aXe</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-http-redirects/">Avoid HTTP redirects in requests</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-disallowed-headers/">Disallow certain HTTP headers</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-manifest-file-extension/">Disallow non-standard file extension for the web app manifest file</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-protocol-relative-urls/">Disallow protocol-relative URLs</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-friendly-error-pages/">Disallow small error pages</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-html-only-headers/">Disallow unneeded HTTP headers for non-HTML resources</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-http-cache/">HTTP Cache</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-image-optimization-cloudinary/">Image optimization with Cloudinary</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-vulnerable-javascript-libraries/">No vulnerable libraries</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-html-checker/">Nu HTML Test</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-performance-budget/">Performance budget</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-content-type/">Require `Content-Type` HTTP response header with appropriate value</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-strict-transport-security/">Require `Strict-Transport-Security` response header</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-x-content-type-options/">Require `X-Content-Type-Options` HTTP response header</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-meta-theme-color/">Require a &apos;theme-color&apos; meta tag with a valid value</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-manifest-exists/">Require a web app manifest file</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-apple-touch-icons/">Require an apple touch icon</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-meta-charset-utf-8/">Require charset meta tag with the value of `utf-8`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-disown-opener/">Require external links to disown opener</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-highest-available-document-mode/">Require highest available document mode</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-manifest-app-name/">Require manifest to specify the web site/app name</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-http-compression/">Require resources to be served compressed</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-sri/">Require scripts and styles to use subresource integrity</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-manifest-is-valid/">Require valid manifest</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-meta-viewport/">Require viewport meta tag with proper value</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-ssllabs/">SSL Server Test</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-validate-set-cookie-header/">Validate `Set-Cookie` Header</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-no-bom/">Warn if the byte-order mark</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/config-exists/">`config-exists`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/is-installed/">`is-installed`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-babel-config/is-valid/">`is-valid`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-typescript-config/is-valid/">`is-valid`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/is-valid/">`is-valid`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/module-esnext-typescript/">`module-esnext-typescript`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/modules-false-babel/">`modules-false-babel`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-typescript-config/no-comments/">`no-comments`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/no-devtool-in-prod/">`no-devtool-in-prod`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-typescript-config/target/">`target`</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-babel-config/">babel-config</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-typescript-config/">typescript-config</a></li><li class="subitem"><a href="/docs/user-guide/rules/rule-webpack-config/">webpack configuration rules set</a></li></ul></li></ul></li></ul></div><div class="module module--secondary table-of-contents treeview main-view" role="navigation"><ul role="tree" aria-labelledby="page-heading" tabindex="0"><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">concepts</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/concepts/configurations/" tabindex="-1">Configurations</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/concepts/connectors/" tabindex="-1">Connectors</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/concepts/formatters/" tabindex="-1">Formatters</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/concepts/parsers/" tabindex="-1">Parsers</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/concepts/rules/" tabindex="-1">Rules</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class=" toc-section-title "><span class="text">further configuration</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/further-configuration/sonarwhalrc-formats/" tabindex="-1">.sonarwhalrc formats</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/further-configuration/browser-context/" tabindex="-1">Browser configuration</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/further-configuration/ignoring-domains/" tabindex="-1">Ignoring domains</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/further-configuration/rules-timeout/" tabindex="-1">Rules timeout</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/further-configuration/website-authentication/" tabindex="-1">Website authentication</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="true"><div class=" toc-section-title--active "><span class="text">rules</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-amp-validator/" tabindex="0">AMP HTML Validator</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-axe/" tabindex="0">Accessibility assessment with aXe</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-http-redirects/" tabindex="0">Avoid HTTP redirects in requests</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-disallowed-headers/" tabindex="0">Disallow certain HTTP headers</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-manifest-file-extension/" tabindex="0">Disallow non-standard file extension for the web app manifest file</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-protocol-relative-urls/" tabindex="0">Disallow protocol-relative URLs</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-friendly-error-pages/" tabindex="0">Disallow small error pages</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-html-only-headers/" tabindex="0">Disallow unneeded HTTP headers for non-HTML resources</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-http-cache/" tabindex="0">HTTP Cache</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-image-optimization-cloudinary/" tabindex="0">Image optimization with Cloudinary</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-vulnerable-javascript-libraries/" tabindex="0">No vulnerable libraries</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-html-checker/" tabindex="0">Nu HTML Test</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-performance-budget/" tabindex="0">Performance budget</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-content-type/" tabindex="0">Require `Content-Type` HTTP response header with appropriate value</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-strict-transport-security/" tabindex="0">Require `Strict-Transport-Security` response header</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-x-content-type-options/" tabindex="0">Require `X-Content-Type-Options` HTTP response header</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-meta-theme-color/" tabindex="0">Require a &apos;theme-color&apos; meta tag with a valid value</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-manifest-exists/" tabindex="0">Require a web app manifest file</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-apple-touch-icons/" tabindex="0">Require an apple touch icon</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-meta-charset-utf-8/" tabindex="0">Require charset meta tag with the value of `utf-8`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-disown-opener/" tabindex="0">Require external links to disown opener</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-highest-available-document-mode/" tabindex="0">Require highest available document mode</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-manifest-app-name/" tabindex="0">Require manifest to specify the web site/app name</a></div></li><li role="treeitem" aria-selected="true"><div class=" toc-subsection-title--active " aria-current="location"><a class="text" href="/docs/user-guide/rules/rule-http-compression/" tabindex="0">Require resources to be served compressed</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-sri/" tabindex="0">Require scripts and styles to use subresource integrity</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-manifest-is-valid/" tabindex="0">Require valid manifest</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-meta-viewport/" tabindex="0">Require viewport meta tag with proper value</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-ssllabs/" tabindex="0">SSL Server Test</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-validate-set-cookie-header/" tabindex="0">Validate `Set-Cookie` Header</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-no-bom/" tabindex="0">Warn if the byte-order mark</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/config-exists/" tabindex="0">`config-exists`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/is-installed/" tabindex="0">`is-installed`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-babel-config/is-valid/" tabindex="0">`is-valid`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-typescript-config/is-valid/" tabindex="0">`is-valid`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/is-valid/" tabindex="0">`is-valid`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/module-esnext-typescript/" tabindex="0">`module-esnext-typescript`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/modules-false-babel/" tabindex="0">`modules-false-babel`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-typescript-config/no-comments/" tabindex="0">`no-comments`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/no-devtool-in-prod/" tabindex="0">`no-devtool-in-prod`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-typescript-config/target/" tabindex="0">`target`</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-babel-config/" tabindex="0">babel-config</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-typescript-config/" tabindex="0">typescript-config</a></div></li><li role="treeitem" aria-selected="false"><div class=" toc-subsection-title " aria-current=""><a class="text" href="/docs/user-guide/rules/rule-webpack-config/" tabindex="0">webpack configuration rules set</a></div></li></ul></li></ul></div><div class="module module--primary wrap-text"> <h1 id="require-resources-to-be-served-compressed-sonarwhalrule-http-compression">Require resources to be served compressed (<code>@sonarwhal/rule-http-compression</code>)<a href="#require-resources-to-be-served-compressed-sonarwhalrule-http-compression" class="headerlink" title="Require resources to be served compressed (`@sonarwhal/rule-http-compression`)"></a></h1><p><code>http-compression</code> warns against serving resources uncompressed
or using an inappropriate encoding.</p>
<h2 id="why-is-this-important">Why is this important?<a href="#why-is-this-important" class="headerlink" title="Why is this important?"></a></h2><p>One of the fastest and easiest ways one can improve web site/app
performance is to reduce the amount of data sent to the client
by using HTTP compression. This not only <a href="https://whatdoesmysitecost.com/" target="_blank" rel="nofollow noreferrer noopener">reduces the data used by
the user</a>, but can also significallty cut down on the server
costs.</p>
<p>Here are a few rules to follow to get the most out of compressing
resources:</p>
<ul>
<li><p>Only compress resources for which the result of the compression
will be smaller than original size.</p>
<p>In general text-based resources (HTML, CSS, JavaScript, SVGs, etc.)
compresss very well especially if the file is not very small.
The same goes for some other file formats (e.g.: ICO files, web fonts
such as EOT, OTF, and TTF, etc.)</p>
<p>However, compressing resources that are already compressed (e.g.:
images, audio files, PDFs, etc.) not only wastes CPU resources, but
usually results in little to no reduction, or in some cases, results
in an increase in file size.</p>
<p>The same applies to resources that are very small because of the
overhead of compression file formats.</p></li>
<li><p>Use the most efficient compression method.</p>
<p>gzip is the most used encoding method currently as it strikes a good
balance between compression ratio (as <a href="https://www.youtube.com/watch?v=Mjab_aZsdxw&amp;t=24s" target="_blank" rel="nofollow noreferrer noopener">high as 70%</a>
especially for larger files) and encoding time, and is supported
pretty much everywhere.</p>
<p>Better savings can be achieved using <a href="https://github.com/google/zopfli" target="_blank" rel="nofollow noreferrer noopener">Zopfli</a> which
can reduce the size on average <a href="https://developers.googleblog.com/2013/02/compress-data-more-densely-with-zopfli.html" target="_blank" rel="nofollow noreferrer noopener">3&#x2013;8% more than gzip</a>. Since Zopfli output (for the gzip option) is valid
gzip content, Zopfli works eveywere gzip works. The only down
side is that encoding takes more time than gzip, making Zopfli
more suitable for static content (i.e. encoding resources as part
of a build script, not on the fly).</p>
<p>Things can be improved even futher using <a href="https://github.com/google/brotli" target="_blank" rel="nofollow noreferrer noopener">Brotli</a>.
This encoding can achieve <a href="https://opensource.googleblog.com/2015/09/introducing-brotli-new-compression.html" target="_blank" rel="nofollow noreferrer noopener">20&#x2013;26% higher compression ratios</a> over Zopfli. However, this encoding is not compatible
with gzip, limiting the support to modern browsers and its usage to
<a href="https://medium.com/@yoavweiss/well-the-technical-reason-for-brotli-being-https-only-is-that-otherwise-there-s-a-very-high-508f15f0ad95" target="_blank" rel="nofollow noreferrer noopener">only over HTTPS (as proxies misinterpreting unknown encodings)</a>.</p>
<p>As a rule, for best performance and interoperability, resources should
be served compressed with Zopfli over insecure HTTP, and Brotli when
sending over HTTPS with a fallback to Zopfli if HTTPS is not supported.</p></li>
<li><p>Avoid using deprecated or not widly supported compression formats,
and <code>Content-Type</code> values.</p>
<p>Avoid using deprecated <code>Content-Type</code> values such as <code>x-gzip</code>. Some
user agents may alias them to the correct, current equivalent value
(e.g.: alias <code>x-gzip</code> to gzip), but that is not always true.</p>
<p>Also avoid using encodings that are not widely supported (e.g.:
<code>compress</code>, <code>bzip2</code>, <a href="https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/nQl0ORHy7sw" target="_blank" rel="nofollow noreferrer noopener"><code>SDCH</code></a>, etc.), and/or may not
be as efficient, or can create problems (e.g.: <a href="https://stackoverflow.com/questions/9170338/why-are-major-web-sites-using-GZIP/9186091#9186091" target="_blank" rel="nofollow noreferrer noopener"><code>deflate</code></a>).</p></li>
<li><p>Avoid potential caching related issues.</p>
<p>When resources are served compressed, they should be served with
the <code>Vary</code> header containing the <code>Accept-Encoding</code> value (or with
something such as <code>Cache-Control: private</code> that prevents caching
in proxy caches and such altogether).</p>
<p>This needs to be done to avoid problems such as an intermediate proxy
caching the compressed version of the resource and then sending it
to all user agents, whether they support that particular encoding
or even requested the compressed version.</p></li>
<li><p>Resources should be served compressed only when requested as such,
appropriately encoded, and without relying on user agent sniffing.</p>
<p>The <code>Accept-Encoding</code> request header specified should be respected.
Sending a resource encoded with a different encoding than one of the
ones accepted can lead to problems.</p></li>
<li><p>Dealing with special cases.</p>
<p>One such special case is <code>SVGZ</code> files that are <code>SVG</code> files
compressed with gzip. Since they are already compressed, they
shouldn&#x2019;t be compressed again. However sending them without the
<code>Content-Encoding: gzip</code> header will create problems as user agents
will not know they need to decompress before trying to display them.</p></li>
</ul>
<h2 id="how-to-use-this-rule">How to use this rule?<a href="#how-to-use-this-rule" class="headerlink" title="How to use this rule?"></a></h2><p>To use it you will have to install it via <code>npm</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install @sonarwhal/rule-http-compression</span><br></pre></td></tr></table></figure>
<p>Note: You can make <code>npm</code> install it as a <code>devDependency</code> using the <code>--save-dev</code>
parameter, or to install it globally, you can use the <code>-g</code> parameter. For
other options see
<a href="https://docs.npmjs.com/cli/install" target="_blank" rel="nofollow noreferrer noopener"><code>npm</code>&apos;s documentation</a>.</p>
<p>And then activate it via the <a href="https://sonarwhal.com/docs/user-guide/further-configuration/sonarwhalrc-formats/" target="_blank" rel="nofollow noreferrer noopener"><code>.sonarwhalrc</code></a>
configuration file:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    &quot;connector&quot;: {...},</span><br><span class="line">    &quot;formatters&quot;: [...],</span><br><span class="line">    &quot;parsers&quot;: [...],</span><br><span class="line">    &quot;rules&quot;: {</span><br><span class="line">        &quot;http-compression&quot;: &quot;error&quot;</span><br><span class="line">    },</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="what-does-the-rule-check">What does the rule check?<a href="#what-does-the-rule-check" class="headerlink" title="What does the rule check?"></a></h2><p>The rule checks for the use cases previously specified, namely, it
checks that:</p>
<ul>
<li><p>Only resources for which the result of the compression is smaller
than original size are served compressed.</p></li>
<li><p>The most efficient encodigs are used (by default the rule check if
Zopfli is used over HTTP and Brotli over <code>HTTPS</code>, however that can
be changed, see: <a href="#can-the-rule-be-configured"><code>Can the rule be configured?</code>
section</a>).</p></li>
<li><p>Deprecated or not widely supported encodigs, and <code>Content-Type</code>
values are not used.</p></li>
<li><p>Potential caching related issues are avoided.</p></li>
<li><p>Resources are served compressed only when requested as such, are
appropriately encoded, and no user-agent detection is done.</p></li>
<li><p>Special cases (such as <code>SVGZ</code>) are handled correctly.</p></li>
</ul>
<h3 id="examples-that-trigger-the-rule">Examples that <strong>trigger</strong> the rule<a href="#examples-that-trigger-the-rule" class="headerlink" title="Examples that **trigger** the rule"></a></h3><p>Resource that should be compressed is not served compressed.</p>
<p>e.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line"></span><br><span class="line">&lt;file content&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should not be compressed is served compressed.</p>
<p>e.g.: When the request for <code>https://example.com/example.png</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: br</span><br><span class="line">Content-Type: image/png</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;file content compressed with Brotli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that compressed results in a bigger or equal size to the
uncompressed size is still served compressed.</p>
<p>e.g.: For <code>http://example.com/example.js</code> containing only <code>const x = 5;</code>,
using the defaults, the sizes may be as follows.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">origina size: 13 bytes</span><br><span class="line"></span><br><span class="line">gzip size:    38 bytes</span><br><span class="line">zopfli size:  33 bytes</span><br><span class="line">brotli size:  17 bytes</span><br></pre></td></tr></table></figure>
<p>When the request for <code>http://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;file content compressed with gzip&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should be compressed is served compressed with deprecated
or disallowed compression method or <code>Content-Encoding</code> value.</p>
<p>e.g.: When the request for <code>http://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>
<p>response contains deprecated <code>x-gzip</code> value for <code>Content-Encoding</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: x-gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;file content compressed with gzip&gt;</span><br></pre></td></tr></table></figure>
<p>response is compressed with disallowed <code>compress</code> compression method</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: compress</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;file content compressed with compress&gt;</span><br></pre></td></tr></table></figure>
<p>or response tries to use deprecated SDCH</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip,</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Get-Dictionary: /dictionaries/search_dict, /dictionaries/help_dict</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;file content compressed with gzip&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should be compressed is not served compressed using
Zopfli over HTTP.</p>
<p>e.g.: When the request for <code>http://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with gzip&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should be compressed is served compressed using Brotli
over HTTP.</p>
<p>e.g.: When the request for <code>http://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: br</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Brotli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should be compressed is not served compressed using
Brotli over HTTPS.</p>
<p>e.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Zopfli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that is served compressed doesn&#x2019;t account for caching
(e.g: is not served with the <code>Vary</code> header with the <code>Accept-Encoding</code>
value included, or something such as <code>Cache-Control: private</code>).</p>
<p>e.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: br</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Brotli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource is blindly served compressed using gzip no matter what the
user agent advertises as supporting.</p>
<p>E.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with gzip&gt;</span><br></pre></td></tr></table></figure>
<p>Resource is served compressed only for certain user agents.</p>
<p>E.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">User-Agent: Mozilla/5.0 Gecko</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line"></span><br><span class="line">&lt;file content&gt;</span><br></pre></td></tr></table></figure>
<p>however when requested with</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:57.0) Gecko/20100101 Firefox/57.0</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: br</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Brotli&gt;</span><br></pre></td></tr></table></figure>
<p><code>SVGZ</code> resource is not served with <code>Content-Encoding: gzip</code> header:</p>
<p>E.g.: When the request for <code>https://example.com/example.svgz</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Type: image/svg+xml</span><br><span class="line"></span><br><span class="line">&lt;file content&gt;</span><br></pre></td></tr></table></figure>
<h3 id="examples-that-pass-the-rule">Examples that <strong>pass</strong> the rule<a href="#examples-that-pass-the-rule" class="headerlink" title="Examples that **pass** the rule"></a></h3><p>Resource that should be compressed is served compressed using Zopfli
over HTTP and with the <code>Vary: Accept-Encoding</code> header.</p>
<p>e.g.: When the request for <code>http://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Zopfli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should be compressed is served compressed using Brotli
over HTTPS and with the <code>Vary: Accept-Encoding</code> header.</p>
<p>e.g.: When the request for <code>https://example.com/example.js</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: br</span><br><span class="line">Content-Type: text/javascript</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line"></span><br><span class="line">&lt;content compressed with Brotli&gt;</span><br></pre></td></tr></table></figure>
<p>Resource that should not be compressed is not served compressed.</p>
<p>e.g.: When the request for <code>https://example.com/example.png</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">&lt;image content&gt;</span><br></pre></td></tr></table></figure>
<p><code>SVGZ</code> resource is served with <code>Content-Encoding: gzip</code> header:</p>
<p>e.g.: When the request for <code>https://example.com/example.svgz</code> contains</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br></pre></td></tr></table></figure>
<p>response is</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/... 200 OK</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: image/svg+xml</span><br><span class="line"></span><br><span class="line">&lt;SVGZ content&gt;</span><br></pre></td></tr></table></figure>
<h2 id="how-to-configure-the-server-to-pass-this-rule">How to configure the server to pass this rule<a href="#how-to-configure-the-server-to-pass-this-rule" class="headerlink" title="How to configure the server to pass this rule"></a></h2><!-- markdownlint-disable MD033 -->
<details><summary>How to configure Apache</summary>
<p>Apache can be configured to conditionally (based on media type)
compress resources using gzip as well as send the appropriate
<code>Content-Encoding</code> and <code>Vary</code> headers using <a href="https://httpd.apache.org/docs/current/mod/mod_deflate.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_deflate</code></a>
and the <a href="https://httpd.apache.org/docs/2.4/mod/mod_filter.html#addoutputfilterbytype" target="_blank" rel="nofollow noreferrer noopener"><code>AddOutputFilterByType</code> directive</a>.</p>
<p>For Zopfli, there isn&#x2019;t a core Apache module or directive to do it,
However, since compressing things using Zopfli takes more time, it&#x2019;s
usually indicated to do it as part of your build step. Once that is
done, Apache needs to be configure to server those pre-compressed
files when gzip compression is requested by the user agent.</p>
<p>Starting with Apache <code>v2.4.26</code>, <a href="https://httpd.apache.org/docs/trunk/mod/mod_brotli.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_brotli</code></a> and the
<a href="https://httpd.apache.org/docs/2.4/mod/mod_filter.html#addoutputfilterbytype" target="_blank" rel="nofollow noreferrer noopener"><code>AddOutputFilterByType</code> directive</a> can be used
to conditionally compress with Brotli as well as add the
<code>Content-Encoding</code> and <code>Vary</code> headers. However, like Zopfli, Brotli can
take more time. So, when provided, <code>mod_brotli</code> may be used to compress
dynamic resources (especially if set to use lower compression quality
levels), but for static resources it&#x2019;s indicated to compress them as
part of the build process and configure Apache to serve those
pre-compressed resources whenever Brotli compression is requested over
HTTPS.</p>
<p>If you don&#x2019;t want to start from scratch, below is a generic starter
snippet that contains the necessary configurations to ensure that
commonly used file types are served compressed and with the appropriate
headers, and thus, make your web site/app pass this rule.</p>
<p>Important notes:</p>
<ul>
<li><p>The following relies on Apache being configure to have the correct
filename extensions to media types mappings (see Apache section from
<a href="../content-type/#how-to-configure-the-server-to-pass-this-rule"><code>content-type</code> rule</a>).</p></li>
<li><p>For Zopfli and Brotli this snippet assumes that running the build
step will result in 3 version for every resource:</p>
<ul>
<li>the original (e.g.: script.js) - you should also have this file
in case the user agent doesn&#x2019;t requests things compressed</li>
<li>the file compressed with Zopfli (e.g.: script.js.gz)</li>
<li>the file compressed with Brotli (e.g.: script.js.br)</li>
</ul></li>
</ul>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_headers.c&gt;</span></span><br><span class="line">    <span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Turn on the rewrite engine (this is necessary in order for</span></span><br><span class="line">        <span class="comment"># the `RewriteRule` directives to work).</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># https://httpd.apache.org/docs/current/mod/core.html#options</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Enable the `FollowSymLinks` option if it isn&apos;t already.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># https://httpd.apache.org/docs/current/mod/core.html#options</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute"><span class="nomarkup">Options</span></span> +FollowSymlinks</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the web host doesn&apos;t allow the `FollowSymlinks` option,</span></span><br><span class="line">        <span class="comment"># it needs to be comment out or removed, and then the following</span></span><br><span class="line">        <span class="comment"># uncomment, but be aware of the performance impact.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># https://httpd.apache.org/docs/current/misc/perf-tuning.html#symlinks</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Options +SymLinksIfOwnerMatch</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Depending on how the server is set up, you may also need to</span></span><br><span class="line">        <span class="comment"># use the `RewriteOptions` directive to enable some options for</span></span><br><span class="line">        <span class="comment"># the rewrite engine.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewriteoptions</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># RewriteBase /</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1) Brotli</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># If `Accept-Encoding` header contains `br`</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="string">&quot;%{HTTP:Accept-encoding}&quot;</span> <span class="string">&quot;br&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># and the request is made over HTTPS.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="string">&quot;%{HTTPS}&quot;</span> <span class="string">&quot;on&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># The Brotli pre-compressed version of the file exists</span></span><br><span class="line">            <span class="comment"># (e.g.: `script.js` is requested and `script.js.gz` exists).</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="string">&quot;%{REQUEST_FILENAME}\.br&quot;</span> <span class="string">&quot;-s&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Then, serve the Brotli pre-compressed version of the file.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;^(.*)&quot;</span> <span class="string">&quot;$1\.br&quot;</span><span class="meta"> [QSA]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set the correct media type of the requested file. Otherwise,</span></span><br><span class="line">            <span class="comment"># it will be served with the br media type since the file has</span></span><br><span class="line">            <span class="comment"># the `.br` extension.</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            <span class="comment"># Also, set the special purpose environment variables so</span></span><br><span class="line">            <span class="comment"># that Apache doesn&apos;t recompress these files.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.(ico|cur)\.br$&quot;</span>      <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/x-icon,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.(md|markdown)\.br$&quot;</span>  <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/markdown,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.appcache\.br$&quot;</span>       <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/cache-manifest,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.atom\.br$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/atom+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.bmp\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/bmp,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.css\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/css,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.eot.\.br$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/vnd.ms-fontobject,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.geojson\.br$&quot;</span>        <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/vnd.geo+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.html?\.br$&quot;</span>          <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/html,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ics\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/calendar,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.json\.br$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.jsonld\.br$&quot;</span>         <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/ld+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.m?js\.br$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/javascript,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.otf\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/otf,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.rdf\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/rdf+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.rss\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/rss+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.svg\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/svg+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ttc\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/collection,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ttf\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/ttf,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.txt\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/plain,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.vc(f|ard)\.br$&quot;</span>      <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/vcard,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.vtt\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/vtt,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.webmanifest\.br$&quot;</span>    <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/manifest+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.xhtml\.br$&quot;</span>          <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/xhtml+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.xml\.br$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set the `Content-Encoding` header.</span></span><br><span class="line"></span><br><span class="line">            <span class="section">&lt;FilesMatch &quot;\.br$&quot;&gt;</span></span><br><span class="line">                <span class="attribute"><span class="nomarkup">Header</span></span> append Content-Encoding br</span><br><span class="line">            <span class="section">&lt;/FilesMatch&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2) Zopfli</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># If `Accept-Encoding` header contains `gzip` and the</span></span><br><span class="line">            <span class="comment"># request is made over HTTP.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="string">&quot;%{HTTP:Accept-encoding}&quot;</span> <span class="string">&quot;gzip&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># The Zopfli pre-compressed version of the file exists</span></span><br><span class="line">            <span class="comment"># (e.g.: `script.js` is requested and `script.js.gz` exists).</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="string">&quot;%{REQUEST_FILENAME}\.gz&quot;</span> <span class="string">&quot;-s&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Then serve the Zopfli pre-compressed version of the file.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;^(.*)&quot;</span> <span class="string">&quot;$1\.gz&quot;</span><span class="meta"> [QSA]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set the media types of the file, as otherwise, because</span></span><br><span class="line">            <span class="comment"># the file has the `.gz` extension, it wil be served with</span></span><br><span class="line">            <span class="comment"># the gzip media type.</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            <span class="comment"># Also, set the special purpose environment variables so</span></span><br><span class="line">            <span class="comment"># that Apache doesn&apos;t recompress these files.</span></span><br><span class="line"></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.(ico|cur)\.gz$&quot;</span>      <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/x-icon,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.(md|markdown)\.gz$&quot;</span>  <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/markdown,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.appcache\.gz$&quot;</span>       <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/cache-manifest,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.atom\.gz$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/atom+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.bmp\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/bmp,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.css\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/css,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.eot.\.gz$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/vnd.ms-fontobject,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.geojson\.gz$&quot;</span>        <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/vnd.geo+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.html?\.gz$&quot;</span>          <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/html,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ics\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/calendar,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.json\.gz$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.jsonld\.gz$&quot;</span>         <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/ld+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.m?js\.gz$&quot;</span>           <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/javascript,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.otf\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/otf,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.rdf\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/rdf+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.rss\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/rss+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.svg\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=image/svg+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ttc\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/collection,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.ttf\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=font/ttf,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.txt\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/plain,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.vc(f|ard)\.gz$&quot;</span>      <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/vcard,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.vtt\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/vtt,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.webmanifest\.gz$&quot;</span>    <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/manifest+json,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.xhtml\.gz$&quot;</span>          <span class="string">&quot;-&quot;</span><span class="meta"> [T=application/xhtml+xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">RewriteRule</span></span> <span class="string">&quot;\.xml\.gz$&quot;</span>            <span class="string">&quot;-&quot;</span><span class="meta"> [T=text/xml,E=no-brotli:1,E=no-gzip:1]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set the `Content-Encoding` header.</span></span><br><span class="line"></span><br><span class="line">            <span class="section">&lt;FilesMatch &quot;\.gz$&quot;&gt;</span></span><br><span class="line">                <span class="attribute"><span class="nomarkup">Header</span></span> append Content-Encoding gzip</span><br><span class="line">            <span class="section">&lt;/FilesMatch&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set the `Vary` header.</span></span><br><span class="line"></span><br><span class="line">        <span class="section">&lt;FilesMatch &quot;\.(br|gz)$&quot;&gt;</span></span><br><span class="line">            <span class="attribute"><span class="nomarkup">Header</span></span> append Vary Accept-Encoding</span><br><span class="line">        <span class="section">&lt;/FilesMatch&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;IfModule mod_deflate.c&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3) gzip</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># [!] For Apache versions below version 2.3.7 you don&apos;t need to</span></span><br><span class="line">    <span class="comment"># enable `mod_filter` and can remove the `&lt;IfModule mod_filter.c&gt;`</span></span><br><span class="line">    <span class="comment"># and `&lt;/IfModule&gt;` lines as `AddOutputFilterByType` is still in</span></span><br><span class="line">    <span class="comment"># the core directives.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># https://httpd.apache.org/docs/current/mod/mod_filter.html#addoutputfilterbytype</span></span><br><span class="line"></span><br><span class="line">    <span class="section">&lt;IfModule mod_filter.c&gt;</span></span><br><span class="line">        <span class="attribute">AddOutputFilterByType</span> DEFLATE <span class="string">&quot;application/atom+xml&quot;</span> \</span><br><span class="line">                                      &quot;application/json&quot; \</span><br><span class="line">                                      &quot;application/manifest+json&quot; \</span><br><span class="line">                                      &quot;application/rdf+xml&quot; \</span><br><span class="line">                                      &quot;application/rss+xml&quot; \</span><br><span class="line">                                      &quot;application/schema+json&quot; \</span><br><span class="line">                                      &quot;application/vnd.ms-fontobject&quot; \</span><br><span class="line">                                      &quot;application/xhtml+xml&quot; \</span><br><span class="line">                                      &quot;font/collection&quot; \</span><br><span class="line">                                      &quot;font/opentype&quot; \</span><br><span class="line">                                      &quot;font/otf&quot; \</span><br><span class="line">                                      &quot;font/ttf&quot; \</span><br><span class="line">                                      &quot;image/bmp&quot; \</span><br><span class="line">                                      &quot;image/svg+xml&quot; \</span><br><span class="line">                                      &quot;image/x-icon&quot; \</span><br><span class="line">                                      &quot;text/cache-manifest&quot; \</span><br><span class="line">                                      &quot;text/css&quot; \</span><br><span class="line">                                      &quot;text/html&quot; \</span><br><span class="line">                                      &quot;text/javascript&quot; \</span><br><span class="line">                                      &quot;text/plain&quot; \</span><br><span class="line">                                      &quot;text/vtt&quot; \</span><br><span class="line">                                      &quot;text/xml&quot;</span><br><span class="line">    <span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Special case: SVGZ</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># If these files type would be served without the</span></span><br><span class="line">    <span class="comment"># `Content-Enable: gzip` response header, user agents would</span></span><br><span class="line">    <span class="comment"># not know that they first need to uncompress the response,</span></span><br><span class="line">    <span class="comment"># and thus, wouldn&apos;t be able to understand the content.</span></span><br><span class="line"></span><br><span class="line">    <span class="section">&lt;IfModule mod_mime.c&gt;</span></span><br><span class="line">        <span class="attribute">AddEncoding</span> gzip              svgz</span><br><span class="line">    <span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>
<p>Also note that:</p>
<ul>
<li><p>The above snippet works with Apache <code>v2.2.0+</code>, but you need to
have <a href="https://httpd.apache.org/docs/current/mod/mod_deflate.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_deflate</code></a>, <a href="https://httpd.apache.org/docs/current/mod/mod_mime.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_mime</code></a>,
<a href="https://httpd.apache.org/docs/current/mod/mod_rewrite.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_rewrite</code></a>, and for Apache versions below
<code>v2.3.7</code> <a href="https://httpd.apache.org/docs/current/mod/mod_filter.html" target="_blank" rel="nofollow noreferrer noopener"><code>mod_filter</code></a> <a href="https://github.com/h5bp/server-configs-apache/wiki/How-to-enable-Apache-modules" target="_blank" rel="nofollow noreferrer noopener">enabled</a> in order for it to take effect.</p></li>
<li><p>If you have access to the <a href="https://httpd.apache.org/docs/current/configuring.html#main" target="_blank" rel="nofollow noreferrer noopener">main Apache configuration file</a> (usually called <code>httpd.conf</code>), you should add
the logic in, for example, a <a href="https://httpd.apache.org/docs/current/mod/core.html#directory" target="_blank" rel="nofollow noreferrer noopener"><code>&lt;Directory&gt;</code></a>
section in that file. This is usually the recommended way as
<a href="https://httpd.apache.org/docs/current/howto/htaccess.html#when" target="_blank" rel="nofollow noreferrer noopener">using <code>.htaccess</code> files slows down</a> Apache!</p>
<p>If you don&#x2019;t have access to the main configuration file (quite
common with hosting services), add the snippets in a <code>.htaccess</code>
file in the root of the web site/app.</p></li>
</ul>
<p></p></details>
<details><summary>How to configure IIS</summary><p></p>
<p>IIS 7+ can be configured to compress responses (static or dynamic) via
the <a href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/urlcompression" target="_blank" rel="nofollow noreferrer noopener"><code>&lt;urlCompression&gt; element</code></a>.</p>
<p>For Zopfli, there isn&#x2019;t a core IIS module to do it. However, since
compressing things using Zopfli takes more time, it&#x2019;s usually indicated
to do it as part of your build step. Once that is done, IIS needs to be
configured to server those pre-compressed files when gzip compression is
requested by the user agent.</p>
<p>Brotli, like Zopfli, takes more time. It&#x2019;s indicated to compress
resources at build time, and configure IIS to serve those pre-compressed
resources whenever Brotli compression is requested over HTTPS by the
user agent.</p>
<p>If you don&#x2019;t want to start from scratch, below is a generic starter
snippet that contains the necessary configurations to ensure that
commonly used file types are served compressed and with the appropriate
headers, and thus, make your web site/app pass this rule.</p>
<p>Important notes:</p>
<ul>
<li><p>The following relies on IIS being configured to have the correct
filename extensions to media types mappings (see IIS section from
<a href="../content-type/#how-to-configure-the-server-to-pass-this-rule"><code>content-type</code> rule</a>).</p></li>
<li><p>For Zopfli and Brotli this snippet assumes that running the build
step will result in 3 version for every resource:</p>
<ul>
<li>the original (e.g.: script.js) - you should also have this file
in case the user agent doesn&#x2019;t requests things compressed</li>
<li>the file compressed with Zopfli (e.g.: script.js.gz)</li>
<li>the file compressed with Brotli (e.g.: script.js.br)</li>
</ul></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">staticContent</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- IIS doesn&apos;t know about Brotli. If mimeMap is not added</span></span><br><span class="line"><span class="comment">                 br files will not be served --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mimeMap</span> <span class="attr">fileExtension</span>=<span class="string">&quot;.br&quot;</span> <span class="attr">mimeType</span>=<span class="string">&quot;application/brotli&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">staticContent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">rewrite</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rewriteMaps</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- List of all the file types and the right `content-type` values</span></span><br><span class="line"><span class="comment">                     when compressed. They will be restored in an outboud rule. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rewriteMap</span> <span class="attr">name</span>=<span class="string">&quot;CompressedExtensions&quot;</span> <span class="attr">defaultValue</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- zopfli mapping --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;appcache.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/cache-manifest; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;bmp.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/bmp&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;css.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/css; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;cur.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;eot.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/vnd.ms-fontobject&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;html.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;ico.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;js.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/javascript; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;json.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;map.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;mjs.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/javascript; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;otf.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;font/otf&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;rss.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/rss+xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;svg.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/svg+xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;ttf.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;font/ttf; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;txt.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/plain; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;vtt.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/vtt; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;webmanifest.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/manifest+json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;xml.gz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- brotli mapping --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;appcache.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/cache-manifest; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;bmp.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/bmp&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;css.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/css; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;cur.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;eot.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/vnd.ms-fontobject&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;html.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;ico.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;js.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/javascript; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;json.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;map.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;mjs.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/javascript; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;otf.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;font/otf&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;rss.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/rss+xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;svg.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;image/svg+xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;ttf.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;font/ttf; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;txt.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/plain; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;vtt.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/vtt; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;webmanifest.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/manifest+json; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">&quot;xml.br&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/xml; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rewriteMap</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rewriteMaps</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Restore the mime type for compressed assets. See below for more explanation. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;RestoreMime&quot;</span> <span class="attr">enabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;RESPONSE_Content_Type&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;.*&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">conditions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_URL}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;\.((?:appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)\.(gz|br))&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{CompressedExtensions:{C:1}}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;(.+)&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;{C:3}&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- add vary header --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;AddVaryAcceptEncoding&quot;</span> <span class="attr">preCondition</span>=<span class="string">&quot;PreCompressedFile&quot;</span> <span class="attr">enabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;RESPONSE_Vary&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;.*&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Accept-Encoding&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- indicate response is encoded with brotli --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;AddEncodingBrotli&quot;</span> <span class="attr">preCondition</span>=<span class="string">&quot;PreCompressedBrotli&quot;</span> <span class="attr">enabled</span>=<span class="string">&quot;true&quot;</span> <span class="attr">stopProcessing</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;RESPONSE_Content_Encoding&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;.*&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;br&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- indicate response is encoded with gzip --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;AddEncodingZopfli&quot;</span> <span class="attr">preCondition</span>=<span class="string">&quot;PreCompressedZopfli&quot;</span> <span class="attr">enabled</span>=<span class="string">&quot;true&quot;</span> <span class="attr">stopProcessing</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;RESPONSE_Content_Encoding&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;.*&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;gzip&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">preConditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">preCondition</span> <span class="attr">name</span>=<span class="string">&quot;PreCompressedFile&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_URL}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;\.((?:appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)\.(gz|br))&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">preCondition</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">preCondition</span> <span class="attr">name</span>=<span class="string">&quot;PreCompressedZopfli&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_URL}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;\.((?:appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)\.gz)&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">preCondition</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">preCondition</span> <span class="attr">name</span>=<span class="string">&quot;PreCompressedBrotli&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_URL}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;\.((?:appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)\.br)&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">preCondition</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">preConditions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rules</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                    Compression rules. This works in combination with the `outbound rules` bellow. Basically what happens is:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    1. We check if the user agent supprots compression via the `Accept-Encoding` header.</span></span><br><span class="line"><span class="comment">                    2. We prioritize `brotli` of `gzip`, and append the right extension (`.gz` or `.br`) and prepend `dist`.</span></span><br><span class="line"><span class="comment">                       `dist` is where all the pulic assets live. This is transparent to the user.</span></span><br><span class="line"><span class="comment">                       We assume all assets with those extensions have a `.gz` and `.br` version because of the build system we</span></span><br><span class="line"><span class="comment">                       have.</span></span><br><span class="line"><span class="comment">                       IIS then serves the asset applying the outbound rules.</span></span><br><span class="line"><span class="comment">                    3. If the final part of the file (`.ext.gz` or `.ext.br`) matches one of the `CompressedExtensions` `rewriteMap`, we</span></span><br><span class="line"><span class="comment">                       rewrite the `content-type` header</span></span><br><span class="line"><span class="comment">                    4. Based on the extension (`.gz` or `.br`), we rewrite the `content-encoding` header</span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;ServerPreCompressedBrotli&quot;</span> <span class="attr">stopProcessing</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">&quot;^(.*/)?(.*?)\.(appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)([?#].*)?$&quot;</span> <span class="attr">ignoreCase</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">conditions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_ACCEPT_ENCODING}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;br&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">url</span>=<span class="string">&quot;dist{REQUEST_URI}.br&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;ServerPreCompressedZopfli&quot;</span> <span class="attr">stopProcessing</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">&quot;^(.*/)?(.*?)\.(appcache|bmp|css|cur|eot|html|ico|js|json|map|mjs|otf|rss|svg|ttf|txt|vtt|webmanifest|xml)([?#].*)?$&quot;</span> <span class="attr">ignoreCase</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">conditions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;{HTTP_ACCEPT_ENCODING}&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;gzip&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">url</span>=<span class="string">&quot;dist{REQUEST_URI}.gz&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Fallback in case the user agent doesn&apos;t support compression --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;static&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">&quot;(?!scanner|search).*$&quot;</span> <span class="attr">ignoreCase</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">url</span>=<span class="string">&quot;dist{REQUEST_URI}&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rewrite</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Note that:</p>
<ul>
<li>The above snippet works with IIS 7+.</li>
<li>You should use the above snippet in the <code>web.config</code> of your
application.</li>
</ul>
<p></p></details><p></p>
<!-- markdownlint-enable MD033 -->
<h2 id="can-the-rule-be-configured">Can the rule be configured?<a href="#can-the-rule-be-configured" class="headerlink" title="Can the rule be configured?"></a></h2><p>You can override the defaults by specifying what type of compression
you don&#x2019;t want the rule to check for. This can be done for the <code>html</code>
(main page) and/or the <code>resources</code> the rule determines should be served
compressed, using the following format:</p>
<p>In the <a href="https://sonarwhal.com/docs/user-guide/further-configuration/sonarwhalrc-formats/" target="_blank" rel="nofollow noreferrer noopener"><code>.sonarwhalrc</code></a> file:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    &quot;connector&quot;: {...},</span><br><span class="line">    &quot;formatters&quot;: [...],</span><br><span class="line">    &quot;rules&quot;: {</span><br><span class="line">        &quot;http-compression&quot;: [ &quot;warning&quot;, {</span><br><span class="line">            &quot;resource&quot;: {</span><br><span class="line">                &quot;&lt;compression_type&gt;&quot;: &lt;true|false&gt;,</span><br><span class="line">                ...</span><br><span class="line">            },</span><br><span class="line">            &quot;html&quot;: {</span><br><span class="line">                &quot;&lt;compression_type&gt;&quot;: &lt;true|false&gt;,</span><br><span class="line">                ...</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        ...</span><br><span class="line">    },</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Where <code>&lt;compression_method&gt;</code> can be one of: <code>brotli</code>, <code>gzip</code>, or
<code>zopfli</code>.</p>
<p>E.g. If you want the rule to check if only the page resources are
served compressed using Brotli, and not the page itself, you can
use the following configuration in the <a href="https://sonarwhal.com/docs/user-guide/further-configuration/sonarwhalrc-formats/" target="_blank" rel="nofollow noreferrer noopener"><code>.sonarwhalrc</code></a>:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    &quot;connector&quot;: {...},</span><br><span class="line">    &quot;formatters&quot;: [...],</span><br><span class="line">    &quot;rules&quot;: {</span><br><span class="line">        &quot;http-compression&quot;: [ &quot;warning&quot;, {</span><br><span class="line">            &quot;html&quot;: {</span><br><span class="line">                &quot;brotli&quot;: false</span><br><span class="line">            }</span><br><span class="line">        }],</span><br><span class="line">        ...</span><br><span class="line">    },</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Note: You can also use the <a href="../../#rule-configuration"><code>ignoredUrls</code></a>
property from the <code>.sonarwhalrc</code> file to exclude domains you don&#x2019;t control
(e.g.: CDNs) from these checks.</p>
<!-- Link labels: -->
<!-- Apache links -->
<!-- IIS links -->
 </div></div><a href="#main" class="anchor-top" hidden aria-label="back to top">top</a></div></article>   </main><footer class="footer footer--home"><div class="footer-nav container"><div class="footer-nav__item"><p class="category"><a href="/scanner/">Scanner</a></p><ul></ul></div><div class="footer-nav__item"><p class="category"><a href="/docs/">Documentation</a></p><ul><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></div><div class="footer-nav__item"><p class="category"><a href="/about/">About</a></p><ul><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></div><ul class="footer-nav__item social-list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow sonarwhal on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25"><path class="github-icon-svg" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow sonarwhal on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 24"><path class="twitter-icon-svg" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li><li class="medium-icon"><a href="https://medium.com/sonarwhal" aria-label="Follow sonarwhal on Medium"><svg xmlns="http://www.w3.org/2000/svg" viewbox="4 2 40 40"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.7-.32 1.03l-2.45 3v.38h6.9v-.4l-2.4-2.98c-.3-.34-.35-.5-.35-1.03v-8.95l6.13 13.36h.7L27 18.42v10.64c0 .3 0 .35-.2.53L25 31.4v.37h9.2v-.4l-1.82-1.8c-.2-.17-.22-.23-.22-.52v-13.1c0-.3.03-.36.2-.54l1.83-1.8v-.32h-6.5L23.1 24.8l-5.2-11.55h-6.8v.4l2.14 2.63c.24.3.3.37.3.77V27.4z" class="medium-icon-svg"/></svg></a></li></ul></div></footer><script src="/static/scripts/treeview-e14923d6bd.js" integrity="sha384-f4cDTA+aFtC3QxumypR+xrziAyyNLALeZLCcS4ZXdc/O93x/9Xyk/IzcUOmkNBDY" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" integrity="sha384-bpcisN7hXHzDmg5JLgtPet7fpev9Wwwqgw8zlXpOh7AkvJ+wYjwrMzHH8fVvq1Dq" crossorigin="anonymous"></script><script src="/static/scripts/common-234f1d98cc.js" integrity="sha384-uQNhTpxyfsvKX1WnECKzm/7fYOFRWjGPmomV8W31O1ZNYBQWBcYpjjO4OqmpZ4M6" crossorigin="anonymous"></script><script>!function(){var e,t=docsearch({apiKey:"2ee58f908e6d720c4f72a9645ce0e857",indexName:"sonarwhal",inputSelector:"#search-input",appId:"0R8E5SPAFP",debug:!1,handleSelected:function(t,o,n){window.innerWidth<e?o.target.closest("form").submit():window.location.href=n.url}}),o=document.querySelector(".algolia-autocomplete .ds-dropdown-menu");e=parseInt(window.getComputedStyle(o).minWidth),t.autocomplete.on("autocomplete:opened",function(){document.body.clientWidth<e&&t.autocomplete.autocomplete.close()})}()</script><script src="/sw-reg.js" integrity="sha384-gRovFrJVkjTNXoDUATy5auNPBtLX1kLAiFPr0Y0558FvYta2yNWP955eXf8tv0KU" crossorigin="anonymous"></script><script>!function(e,a,t,c,g){e.GoogleAnalyticsObject="ga",e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,c=a.createElement("script"),g=a.scripts[0],c.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(this,document),ga("create","UA-101540923-1"),ga("send","pageview")</script></body></html>